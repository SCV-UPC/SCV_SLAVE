# -*- coding: utf-8-*-
import logging
from notifier import Notifier
from brain import Brain

import re
import Pyro4
import os
import time

prova=Pyro4.Proxy("PYRO:jasper.multipleMicrophones@192.168.1.37:5161")

def isValid(words,text):
	for el in words:
		if bool(re.search(r'\b%s\b'%(el), text, re.IGNORECASE)):
			pass
		else:
			return False
	return True
         

class Conversation(object):

    def __init__(self, persona, mic, profile):
        self._logger = logging.getLogger(__name__)
        self.persona = persona
        self.mic = mic
        self.profile = profile
        self.brain = Brain(mic, profile)
        self.notifier = Notifier(profile)

    def handleForever(self):
       

        while True:

            threshold, transcribed = self.mic.passiveListen(self.persona)
           
            if not transcribed or not threshold:
                
                continue
	    t1=time.time()
	    if prova.valor_actual()==1:
		prova.modifica(0)
		t2=time.time()
            	text = self.mic.activeListenToAllOptions(threshold)
		print text

	
	    	if 'ENCENDER' in text[0]:

			os.system('python /home/pi/SCV-jasper/PythonScripts/encender.py')

		elif 'APAGAR' in text[0]:

			os.system('python /home/pi/SCV-jasper/PythonScripts/apagar.py')
		
		time.sleep(0.5)
		prova.modifica(1)
          	try:
			print t2-t1
		except:
			pass
            
